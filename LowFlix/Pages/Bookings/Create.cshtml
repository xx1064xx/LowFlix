@page
@model LowFlix.Pages.Bookings.CreateModel
@{
    ViewData["Title"] = "Create";
}

<h1>@ViewData["Title"] Booking</h1>

<div class="row">
    <div class="col-md-4">
        <form method="post">
            <div class="formGroup">
                <label asp-for="Booking.CustomerId">Customer</label>
                <select class="inputField" asp-for="Booking.CustomerId" asp-items="Model.CustomerList"></select>
            </div>
            <div class="formGroup">
                <label>Film</label>
                <select class="inputField" asp-items="Model.FilmList" id="FilmSelector"></select>
            </div>
            <div class="formGroup">
                <label asp-for="Booking.FilmCopyId">Film</label>
                <select class="inputField" asp-for="Booking.FilmCopyId" id="FilmCopySelector"></select>
            </div>
            <div class="formGroup">
                <label asp-for="Booking.RentalDate"></label>
                <input class="inputField" asp-for="Booking.RentalDate" />
            </div>
            <div class="buttonGroup">
                <input type="submit" value="Create" class="btn primaryButton"/>
                <a asp-page="Index" class="btn secondaryButton">Cancel</a>
            </div>
        </form>

    </div>
</div>

<script>

    const filmSelector = document.getElementById('FilmSelector');
    const filmCopySelector = document.getElementById('FilmCopySelector');
    var pedaloData = null;
    
    filmSelector.addEventListener("change", function () {

        
        
        filmCopySelector.innerHTML = '';

        pedaloData.forEach(option => {

            if (option.filmId == filmSelector.value.toLowerCase()) {

                filmCopySelector.innerHTML += `<option value="${option.filmCopyId}">${option.filmNumber}</option>`;
            }

        });


    });
    

    document.addEventListener("DOMContentLoaded", function () {

        fetchressources();

    });

    function fetchressources() {
        fetch('/Bookings/Create?handler=FilmCopyList')
            .then(response => response.json())
            .then(data => {

                pedaloData = data;
                console.log(data);


                // fill options

                filmCopySelector.innerHTML = '';

                data.forEach(option => {
                    
                    if (option.filmId == filmSelector.value.toLowerCase()) {

                        filmCopySelector.innerHTML += `<option value="${option.filmCopyId}">${option.filmNumber}</option>`;
                    }

                });





            })
            .catch(error => console.error('Error:', error));


    }

</script>